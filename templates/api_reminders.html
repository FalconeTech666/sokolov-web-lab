{% extends 'base.html' %}
{% block title %}Reminders API{% endblock %}

{% block content %}
<h1>Reminders API</h1>
<p>Планировщик фоновых напоминаний.</p>

<div class="api-section">
    <h2>1. Описание API</h2>
    <p><strong>Назначение:</strong> Создание напоминаний с отложенным срабатыванием (Фоновые задачи FastAPI).</p>
    <ul>
        <li><code>GET /fastapi/reminders/</code> — Получить список напоминаний</li>
        <li><code>POST /fastapi/reminders/</code> — Создать напоминание</li>
        <li><code>DELETE /fastapi/reminders/{id}</code> — Удалить напоминание</li>
    </ul>
    <h3>Пример кода</h3>
    <pre><code># cURL
curl -X POST "http://sokolweblab.ru/fastapi/reminders/" \
-H "Content-Type: application/json" \
-d '{"text": "Полить цветы", "delay_seconds": 60}'</code></pre>
</div>

<div class="api-section">
    <h2>2. Тестирование</h2>
    <div class="api-form-group">
        <label>Операция</label>
        <select id="reminders-op" onchange="toggleRemindersFields()">
            <option value="GET">Получить список (GET)</option>
            <option value="POST">Создать (POST)</option>
            <option value="DELETE">Удалить (DELETE)</option>
        </select>
    </div>
    
    <div id="reminder-id-group" class="api-form-group" style="display: none;">
        <label>Reminder ID</label>
        <input type="number" id="reminder-id" placeholder="ID напоминания">
    </div>

    <div id="reminder-payload-group" class="api-form-group" style="display: none;">
        <label>Текст (Text)</label>
        <input type="text" id="reminder-text" placeholder="Текст напоминания">
        <br><br>
        <label>Задержка (секунды)</label>
        <input type="number" id="reminder-delay" placeholder="60">
    </div>

    <button class="btn" onclick="testRemindersApi()">Отправить запрос</button>

    <div id="reminders-result" class="api-result">Ожидание запроса...</div>
</div>

<script>
function toggleRemindersFields() {
    const op = document.getElementById('reminders-op').value;
    document.getElementById('reminder-id-group').style.display = (op === 'DELETE') ? 'block' : 'none';
    document.getElementById('reminder-payload-group').style.display = (op === 'POST') ? 'block' : 'none';
}

async function testRemindersApi() {
    const op = document.getElementById('reminders-op').value;
    const remId = document.getElementById('reminder-id').value;
    let endpoint = '/reminders/';
    let payload = null;

    if (op === 'DELETE') {
        if (!remId) return alert('Введите ID');
        endpoint += remId;
    }
    if (op === 'POST') {
        payload = {
            text: document.getElementById('reminder-text').value,
            delay_seconds: parseInt(document.getElementById('reminder-delay').value || '0')
        };
    }
    await handleApiCall('reminders-result', op, endpoint, payload);
}
</script>
{% endblock %}
